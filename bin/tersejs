#!/bin/env bash

OPTIND=1         # Reset in case getopts has been used previously in the shell.

outFile=""
show_help()
{
cat << EOF
help will be here
EOF
}

sweetOpts=""
while getopts "h?so:" opt; do
    case "$opt" in
    h|\?)
        show_help
        exit 0
        ;;
    o)  outFile=$OPTARG
        ;;
    s)  sweetOpts=$OPTARG
        ;;
    esac
done

shift $((OPTIND-1))

[ "$1" = "--" ] && shift

thisDir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
macroDir=$thisDir/../macros

outOpt=""
if [ -n "$outFile" ]; then
   outOpt=" -o $outFile"
fi

sjs --readable-names -m $macroDir/do.sjs -m $macroDir/fun.sjs -m $macroDir/func_apply.sjs -m $macroDir/conditionals.sjs -m $macroDir/precedence.sjs -m $macroDir/self.sjs -m $macroDir/pipe.sjs -m $macroDir/lambda_chop.sjs <($thisDir/indent_to_braces $1) $sweetOpts $outOpt $1


