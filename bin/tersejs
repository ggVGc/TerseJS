#!/bin/env bash

OPTIND=1         # Reset in case getopts has been used previously in the shell.

outFile=""
show_help()
{
cat << EOF
help will be here
EOF
}

sweetOpts=""
compile=false
while getopts "h?ocs:" opt; do
    case "$opt" in
    h|\?)
        show_help
        exit 0
        ;;
    o)  outFile=$OPTARG
        ;;
    c)  compile=true
        ;;
    s)  sweetOpts=$OPTARG
        ;;
    esac
done

shift $((OPTIND-1))

[ "$1" = "--" ] && shift
inFile=$1
if $compile; then
   outFile=$(basename $inFile | cut -d. -f1).js
fi

outOpt=""
if [ -n "$outFile" ]; then
   outOpt=" -o $outFile"
fi

macroModNames=do,fun,func_apply,conditionals,self,pipe,lambda_chop

thisDir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd -P )
macroDir=$thisDir/../macros
macroIncludes=$(eval "echo -m\ $macroDir/{"$macroModNames"}.sjs")

sjs --readable-names $macroIncludes <($thisDir/indent_to_braces $inFile) $sweetOpts $outOpt $inFile


